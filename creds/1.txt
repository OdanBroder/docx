1. Windows Hash – Cơ chế lưu trữ và kịch bản tấn công
Windows không lưu mật khẩu người dùng dưới dạng plaintext mà sử dụng cơ chế băm (hash) nhằm giảm rủi ro lộ mật khẩu.

1.1. Các loại Windows Hash:
- NTLM hash: cơ chế chính được sử dụng trong xác thực Windows hiện đại.
- LM hash: cơ chế cũ, yếu, đã bị vô hiệu hóa trên các hệ thống mới.

1.2. Vị trí lưu trữ credential:
- SAM Database: lưu NTLM hash của tài khoản local.
- Registry HKLM\SAM: chỉ truy cập được với quyền SYSTEM.
- Bộ nhớ LSASS: khi người dùng đăng nhập, hash được nạp vào bộ nhớ.

1.3. Kịch bản Red Team (mô tả khái niệm):
- Sau khi có quyền Administrator, attacker có thể tiếp cận SAM để thu thập hash.
- Hash bị lộ có thể được tái sử dụng để xác thực trên hệ thống khác.
- Trong môi trường domain, NTLM hash của tài khoản đặc quyền có giá trị rất cao.

1.4. Ý nghĩa phòng thủ:
- Hạn chế quyền Administrator.
- Bật Credential Guard và vô hiệu NTLM khi có thể.
2. LSASS – Mục tiêu trọng yếu trong tấn công nội bộ
LSASS là tiến trình trung tâm chịu trách nhiệm xác thực và thực thi chính sách bảo mật của Windows.

2.1. Thông tin nhạy cảm trong LSASS:
- NTLM hash của user đã đăng nhập.
- Kerberos Ticket Granting Ticket (TGT).
- Vé dịch vụ (TGS).
- Trong một số trường hợp: plaintext credential.

2.2. Quyền và bảo vệ:
- LSASS chạy dưới quyền SYSTEM.
- Có thể được bảo vệ bằng Protected Process Light (PPL).

2.3. Điều kiện tấn công (khái niệm):
- Attacker cần quyền Administrator hoặc SYSTEM.
- Cần các đặc quyền như SeDebugPrivilege.

2.4. Kịch bản Red Team thường gặp:
- Dump bộ nhớ LSASS để thu thập credential.
- Trích xuất Kerberos ticket để di chuyển ngang (lateral movement).
- Lợi dụng hệ thống chưa bật PPL hoặc Credential Guard.

2.5. Góc nhìn Blue Team:
- Giám sát hành vi truy cập LSASS.
- Áp dụng Attack Surface Reduction rules.
3. Pass-the-Hash và Stealing Access Token – So sánh kịch bản tấn công
Hai kỹ thuật này đều nhằm lạm dụng thông tin xác thực mà không cần biết mật khẩu gốc.

3.1. Pass-the-Hash:
- Sử dụng NTLM hash để xác thực từ xa.
- Thường dùng khi attacker có được hash từ SAM hoặc LSASS.
- Hiệu quả trong môi trường domain nếu NTLM còn được cho phép.

3.2. Stealing/Abusing Access Token:
- Lợi dụng access token của tiến trình hợp lệ.
- Không cần xác thực lại.
- Rất stealth vì không tạo log đăng nhập mới.

3.3. So sánh tổng quát:
- Pass-the-Hash dễ bị phát hiện hơn qua log xác thực.
- Token abuse khó phát hiện nhưng phạm vi thường giới hạn trên máy cục bộ.
Kết luận chung
Các kỹ thuật tấn công credential trong Windows chủ yếu khai thác việc quản lý quyền và bảo vệ chưa chặt chẽ. Việc hiểu rõ các kịch bản Red Team giúp đội ngũ phòng thủ xây dựng biện pháp phát hiện và giảm thiểu hiệu quả hơn.

